name: Build

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build:
    name: ${{ matrix.distro }}
    runs-on: ubuntu-latest
    container:
      image: ghcr.io/fullaxx/fbpanel_builder:${{ matrix.distro }}

    strategy:
      fail-fast: false
      matrix:
        distro:
          - noble
          - jammy
          - focal
          - trixie
          - bookworm
          - bullseye

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Configure
        run: cmake -B build -DCMAKE_INSTALL_PREFIX=/usr -DCMAKE_INSTALL_LIBDIR=lib

      - name: Build
        run: make -C build -j$(nproc)

      - name: Install (staging)
        run: make -C build install DESTDIR=/tmp/fbpanel_staging
